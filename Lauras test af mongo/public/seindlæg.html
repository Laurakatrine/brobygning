<!DOCTYPE html>
<html>

<head>
    <title></title>
</head>
<script src="/javascripts/jquery.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
    $(document).ready(function() {
        var files = [];
        var chunks = [];

        var buttonPressed = false;
        var fotoData;
        var nr = 0;
        var lastChunckName;
        var fotoArray = [];

        let socket = io.connect('/'); // default namespace for Socket.io

        socket.emit("readyLoad");

        //
        console.log("button: " + buttonPressed);
        $.get('/chunks', function(data) {
            for (i = 0; i < data.length; i++) {
                chunks.push(data[i]);
            }
            console.log(chunks);
        }).done(function() {
            $.get('/files', function(data) {
                for (i = 0; i < data.length; i++) {
                    files.push(data[i]);
                }
                console.log(files);
                console.log("Her: " + files[0].id + files[0].type);
                console.log("længde" + chunks.length);



                for (j = 0; j < files.length; j++) {

                    for (i = 0; i < chunks.length; i++) {


                        if (chunks[i].files_id == files[j].id) {


                            if (lastChunckName == chunks[i].files_id) {
                                fotoArray[chunks[i].nr] = chunks[i].data;

                            } else {

                                lastChunckName = chunks[i].files_id;
                                fotoArray[chunks[i].nr] = chunks[i].data;
                                console.log("nyt billede" + chunks[i].files_id);
                            }

                        }



                        $('#fotos').append($(document.createElement('img')).prop({
                            id: 'foto' + (j)
                        }));

                        fotoData = "";

                        for (k = 0; k < fotoArray.length; k++) {
                            fotoData += fotoArray[k];

                        }


                        $('#foto' + (j)).attr("src", "data:image/" + files[j].type + ";base64," + fotoData);
                        
                        console.log(fotoData);





                    }
                }

            });
        });



        $(function() {
            console.log("new page");
            $("#navbar").load("navbar.html");

            if (localStorage.getItem("login") == "false") {
                console.log("im not logged in");

                $('#indhold').hide();
            }
            if (localStorage.getItem("login") == "true") {
                console.log("im already logged in");
                $('#indhold').show();
            }

            socket.on("saved", (data) => {
                console.log("saved " + data);
                $('#indhold').text("");
                var dataObj = JSON.parse(data);


                for (i = 0; i < dataObj.length; i++) {
                    $('#indhold').append(dataObj[i].indlæg + " & " + dataObj[i].brugernavn + "<br />");


                    //console.log(dataObj[i].brugernavn);
                }

            });


        });
    });

</script>

<body>
    <div id="navbar">

    </div>

    <div>

        <p>Her kan vi se indlæggene</p>
        <div id="fotos">
        </div>
        <img id="foto">


    </div>
    <p>
    <div id=indhold>
        <p>Det her er index siden!</p>

    </div>


    </p>



</body>

</html>
