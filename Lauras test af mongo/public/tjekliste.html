<!DOCTYPE html>
<html>

<head>
    <title></title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<script src="/javascripts/jquery.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
    $(document).ready(function() {

        $("#ekstraNav").load("navbarEkstra.html");
        $("#navbar").load("navbar.html");
        $("footer").load("footer.html");
        let socket = io.connect('/');
        var labelText;

        $(function() {


            var username = localStorage.getItem('gruppenavn');
            var nr;

            socket.emit('checkboxCheck', username);

            
            //kan ikke lide dataObj[i]:id
            socket.on('checkboxBack', (data) => {
                var dataObj = JSON.parse(data);
                console.log(dataObj);
                console.log(data);
                $('#checks').empty();

                nr = dataObj.length;
                console.log(dataObj.length);
                for (var i = 0; i <= dataObj.length; i++) {
                    console.log(dataObj[i].id);
                    $('#checks').append(
                        $(document.createElement('input')).prop({
                            id: dataObj[i].id,
                            type: 'checkbox',
                            name: dataObj[i].label
                        })).append($(document.createElement('label')).prop({
                        for: dataObj[i].id
                    }).html(dataObj[i].label)).append(document.createElement('br'));


                    if (dataObj[i].checked == true) {
                        var newData = "#" + dataObj[i].id;

                    }
                    console.log(newData);
                    $(newData).prop('checked', true);
                }

            });

            if (localStorage.getItem("login") == "false") {
                console.log("im not logged in");

                $('#indhold').hide();
            }
            if (localStorage.getItem("login") == "true") {
                console.log("im already logged in");
                $('#indhold').show();
            }



            $('#moreChecks').click(() => {
                console.log('cliked');
                var id = 'checkbox' + (nr + 1);
                var checked = false;
                console.log("This is id: " + id);
                labelText = prompt("Giv opgaven et navn", "");

                console.log(labelText.length);
                if (labelText.length == 0) {
                    alert("Giv den et navn!");
                    labelText = prompt("Giv opgaven et navn", "");
                } else {
                    $('#checks').append(
                        $(document.createElement('input')).prop({
                            id: 'checkbox' + (nr + 1),
                            type: 'checkbox',
                            name: labelText
                        })).append($(document.createElement('label')).prop({
                        for: 'checkbox' + (nr + 1)
                    }).html(labelText)).append(document.createElement('br'));
                    nr = nr + 1;
                    console.log('jeg har skabt en ny' + labelText + "mit brugernavn er " + username);
                    
                    socket.emit('checkbox', username, id, checked, labelText);
                    //virker ikke 
                    
                }


            });


            //man kan oprette nye tjekbokse og den registrerer deres dynamiske id.
            //de skal gemmes et sted.. så de bliver der istedet for at forsvinde
            $('#checks').on('change', 'input[type="checkbox"]', (function() {
                console.log(this.id);
                if ($(this).is(":checked")) {
                    var name = this.name;
                    var id = this.id;
                    var checked = true;
                    console.log("id is" + id);
                    socket.emit('checkbox', username, id, checked, name);
                } else {
                    var name = this.name;
                    var id = this.id;
                    var checked = false;
                    console.log("id is " + id);
                    socket.emit('checkbox', username, id, checked, name);
                }
            }))


            /*$("#checks :checkbox").change(function(e){
                console.log("Its changing");
                if($(this).is(":checked")){
                    
                    var id = this.id;
                    var checked = true;
                    console.log(id);
                    socket.emit('checkbox', username, id, checked);
                } else {
                    var id = this.id;
                    var checked = false;
                    console.log(id);
                    socket.emit('checkbox', username, id, checked);
                }
            });*/



        });

    });

</script>

<body>
    <div id="navbar">

    </div>

    <div id="ekstraNav">
    </div>
    <div id="beskrivelse">
    <h2>Tjeklisten</h2>
        <div id=indhold>
            <p>Her kan i lave en tjekliste over de ting i skal nå omhandlende jeres projekt. I kan tjekke de forskellige opgaver af, og på den måde holde styr på hvad i så skal til.</p>
            <p>Find selv på flere opgaver, og tilføje den ved at tryk på +. Lav på den måde en plan for jeres projekt. Husk at tage hensyn til eventuelle tørretider.</p>

            <div id="checks">
                <input type="checkbox" id="checkbox1">
                <label for="checkbox1">Første opgave</label><br>
                <input type="checkbox" id="checkbox2">
                <label for="checkbox2">Anden opgave</label><br>
                <input type="checkbox" id="checkbox3">
                <label for="checkbox3">Tredje opgave</label><br>
            </div>
            <input type="button" id="moreChecks" value="+">
        </div>
        </div>




    <div id="spacer">


    </div>



</body>
<footer>
</footer>

</html>
