<!DOCTYPE html>
<html>

<head>
    <title></title>
</head>
<script src="/javascripts/jquery.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
    $(document).ready(function() {

        let socket = io.connect('/');

        $(function() {

            $("#navbar").load("navbar.html");
            var username = localStorage.getItem('gruppenavn');

            socket.emit('checkboxCheck', username);

            socket.on('checkboxBack', (data) => {
                var dataObj = JSON.parse(data);
                
                for(var i = 0; i<dataObj.length; i++){
                    
                    if(dataObj[i].checked == true){
                        console.log(dataObj[i].id);
                        var newData = "#"+dataObj[i].id;
                       
                    }
                     console.log(newData);
                    $(newData).prop('checked', true);
                }
                
            });

            if (localStorage.getItem("login") == "false") {
                console.log("im not logged in");

                $('#indhold').hide();
            }
            if (localStorage.getItem("login") == "true") {
                console.log("im already logged in");
                $('#indhold').show();
            }
            
            var nr = 3;

            $('#moreChecks').click(()=> {
                $('#checks').append(
                $(document.createElement('input')).prop({
                    id: 'checkbox'+(nr+1),
                    type: 'checkbox'
                })).append($(document.createElement('label')).prop({
                    for: 'checkbox'+(nr+1)
                }).html('Ny tjekboks')
                ). append(document.createElement('br'));
                nr = nr + 1;
            });
            
            
            //man kan oprette nye tjekbokse og den registrerer deres dynamiske id.
            //de skal gemmes et sted.. så de bliver der istedet for at forsvinde
            $('#checks').on('change', 'input[type="checkbox"]', (function(){
                console.log(this.id);
                if($(this).is(":checked")){
                    
                    var id = this.id;
                    var checked = true;
                    console.log("id is"+id);
                    //socket.emit('checkbox', username, id, checked);
                } else {
                    var id = this.id;
                    var checked = false;
                    console.log("id is "+id);
                    //socket.emit('checkbox', username, id, checked);
                }
            }))

            
            /*$("#checks :checkbox").change(function(e){
                console.log("Its changing");
                if($(this).is(":checked")){
                    
                    var id = this.id;
                    var checked = true;
                    console.log(id);
                    socket.emit('checkbox', username, id, checked);
                } else {
                    var id = this.id;
                    var checked = false;
                    console.log(id);
                    socket.emit('checkbox', username, id, checked);
                }
            });*/
            
            

        });

    });

</script>

<body>
    <div id="navbar">

    </div>
    <p>
        <div id=indhold>
            <div id="checks">
                <input type="checkbox" id="checkbox1">
                <label for="checkbox1">Første opgave</label><br>
                <input type="checkbox" id="checkbox2">
                <label for="checkbox2">Anden opgave</label><br>
                <input type="checkbox" id="checkbox3">
                <label for="checkbox3">Tredje opgave</label><br>
            </div>


            <p>Det her er tjeklisten</p>
            <input type="button" id="moreChecks" value="Tilføj">
        </div>


    </p>

    <div>



    </div>



</body>

</html>
